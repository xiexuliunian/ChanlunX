name: Build Plugin

on: [push, pull_request]

jobs:
  build:
    # 替换已淘汰的 windows-2019 
    runs-on: windows-2022 

    steps:
    - uses: actions/checkout@v4
    
    # 使用 VS 2022 生成器，但指定使用 VS 2019 的工具集 (v142) 编译 32 位目标文件
    - name: Configure and Build
      run: |
        mkdir build
        cd build
        cmake -G "Visual Studio 17 2022" -A Win32 -T v142 ..
        cmake --build . --config Release

    - name: Upload Tdx DLL
      uses: actions/upload-artifact@v4
      with:
        name: TdxPlugin-DLL
        path: build/Release/*.dll
